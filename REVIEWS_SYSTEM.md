# 評論系統使用說明

## 功能概述

評論系統為開心書店添加了完整的書籍評分和評論功能，用戶可以對購買過的書籍進行評論和評分。

## 主要功能

### 1. 書籍評論與評分
- **5星評分系統**：用戶可以給書籍評分1-5星
- **評論標題**：可選的評論標題
- **評論內容**：詳細的評論文字
- **驗證購買**：自動識別是否為已購買用戶的評論

### 2. 評論管理
- **唯一性限制**：每個用戶對每本書只能評論一次
- **編輯評論**：用戶可以編輯自己的評論
- **刪除評論**：用戶可以刪除自己的評論
- **評論排序**：支援多種排序方式（最新、最舊、評分高低）

### 3. 評論互動
- **有用性投票**：其他用戶可以對評論投票表示有用或無用
- **評論統計**：顯示每本書的平均評分和評論數量
- **評分分布**：顯示1-5星評分的分布統計

### 4. 評論展示
- **書籍詳情頁**：顯示平均評分、最近評論預覽
- **專門評論頁**：完整的評論列表頁面
- **用戶評論頁**：查看用戶的所有評論

## URL 路由

```
reviews/add/<int:book_id>/          # 添加評論
reviews/edit/<int:review_id>/       # 編輯評論
reviews/delete/<int:review_id>/     # 刪除評論
reviews/book/<int:book_id>/         # 書籍評論列表
reviews/helpful/<int:review_id>/    # 評論有用性投票
reviews/user/<str:username>/        # 用戶評論列表
reviews/my-reviews/                 # 我的評論
```

## 模型結構

### Review 模型
- `user`: 評論用戶
- `book`: 被評論的書籍
- `rating`: 評分(1-5)
- `title`: 評論標題(可選)
- `content`: 評論內容
- `is_verified_purchase`: 是否為驗證購買
- `created_at`: 創建時間
- `updated_at`: 更新時間

### ReviewHelpful 模型
- `user`: 投票用戶
- `review`: 被投票的評論
- `is_helpful`: 是否有用
- `created_at`: 投票時間

### Book 模型新增字段
- `average_rating`: 平均評分
- `review_count`: 評論數量

## 權限控制

- **評論權限**：需要登入用戶
- **編輯權限**：只能編輯自己的評論
- **刪除權限**：只能刪除自己的評論
- **投票權限**：不能對自己的評論投票

## 自動化功能

- **驗證購買**：自動檢查用戶是否購買過該書籍
- **評分更新**：新增/編輯/刪除評論時自動更新書籍平均評分
- **重複限制**：防止同一用戶對同一書籍重複評論

## 管理後台

Django admin 中可以管理：
- 查看所有評論
- 按評分、驗證購買狀態篩選
- 搜尋評論內容
- 查看評論有用性投票

## 使用流程

1. **用戶瀏覽書籍** → 查看書籍詳情頁的評分和評論
2. **點擊寫評論** → 跳轉到評論表單頁面
3. **填寫評論** → 選擇評分、輸入標題和內容
4. **提交評論** → 評論發布，更新書籍評分
5. **其他用戶** → 可以對評論投票表示有用或無用

## 前端樣式

- 響應式設計，支援手機和桌面端
- Bootstrap 樣式框架
- 星星評分顯示
- 評論排序和分頁功能
- AJAX 有用性投票（不刷新頁面）

## 測試

包含完整的單元測試：
- 模型測試
- 視圖測試  
- 表單測試
- 權限測試
